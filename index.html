<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>3D –ó–µ–º–ª—è PRO</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:#000;
  font-family:sans-serif;
}
#ui{
  position:absolute;
  top:10px;
  left:10px;
  background:rgba(0,0,0,0.7);
  padding:10px;
  border-radius:8px;
  color:#FFA500;
}
</style>
</head>
<body>

<div id="ui">
–ö–ª–∏–∫ –ø–æ –ó–µ–º–ª–µ ‚Üí –ø–æ–≥–æ–¥–∞ —Ç–æ—á–∫–∏ üåç
<div id="weather"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>

<script>
// ===== –°–¶–ï–ù–ê =====
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
60,
window.innerWidth/window.innerHeight,
0.1,
1000
);
camera.position.z = 3;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// ===== –°–í–ï–¢ (–°–û–õ–ù–¶–ï) =====
const sunLight = new THREE.DirectionalLight(0xffffff,1.5);
sunLight.position.set(5,0,5);
scene.add(sunLight);

// ===== –ì–õ–û–ë–£–° =====
const geometry = new THREE.SphereGeometry(1,64,64);

const earthTexture = new THREE.TextureLoader().load(
"https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg"
);

const earthMaterial = new THREE.MeshPhongMaterial({
map:earthTexture
});

const earth = new THREE.Mesh(geometry,earthMaterial);
earth.castShadow = true;
earth.receiveShadow = true;
scene.add(earth);

// ===== –ù–û–ß–ù–´–ï –û–ì–ù–ò =====
const nightTexture = new THREE.TextureLoader().load(
"https://threejs.org/examples/textures/planets/earth_lights_2048.png"
);

const nightMaterial = new THREE.MeshBasicMaterial({
map:nightTexture,
blending:THREE.AdditiveBlending,
transparent:true,
opacity:0.6
});

const night = new THREE.Mesh(geometry,nightMaterial);
scene.add(night);

// ===== –û–ë–õ–ê–ö–ê =====
const cloudTexture = new THREE.TextureLoader().load(
"https://threejs.org/examples/textures/planets/earth_clouds_1024.png"
);

const cloudMaterial = new THREE.MeshLambertMaterial({
map:cloudTexture,
transparent:true,
opacity:0.4
});

const clouds = new THREE.Mesh(
new THREE.SphereGeometry(1.01,64,64),
cloudMaterial
);

scene.add(clouds);

// ===== RAYCAST –î–õ–Ø –ö–õ–ò–ö–ê =====
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

window.addEventListener("click",async (event)=>{

mouse.x = (event.clientX/window.innerWidth)*2-1;
mouse.y = -(event.clientY/window.innerHeight)*2+1;

raycaster.setFromCamera(mouse,camera);
const intersects = raycaster.intersectObject(earth);

if(!intersects.length) return;

const point = intersects[0].point;

const lat = 90 - (Math.acos(point.y)*180/Math.PI);
const lon =
((Math.atan2(point.z,point.x)*180/Math.PI)+180)%360-180;

getWeather(lat,lon);
});

// ===== –ú–ê–†–ö–ï–† =====
function addMarker(lat,lon){

const phi=(90-lat)*(Math.PI/180);
const theta=(lon+180)*(Math.PI/180);

const x=-Math.sin(phi)*Math.cos(theta);
const y=Math.cos(phi);
const z=Math.sin(phi)*Math.sin(theta);

const marker=new THREE.Mesh(
new THREE.SphereGeometry(0.02,16,16),
new THREE.MeshBasicMaterial({color:0xff0000})
);

marker.position.set(x,y,z);
earth.add(marker);
}

// ===== –û–ó–í–£–ß–ö–ê =====
function speak(text){

const synth=window.speechSynthesis;
const utter=new SpeechSynthesisUtterance(text);

utter.lang="ru-RU";

synth.cancel();
synth.speak(utter);
}

// ===== –ü–û–ì–û–î–ê –ü–û –ö–û–û–†–î =====
async function getWeather(lat,lon){

addMarker(lat,lon);

const data=await fetch(
`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`
).then(r=>r.json());

const w=data.current_weather;

const text=
`–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ${w.temperature} –≥—Ä–∞–¥—É—Å–æ–≤.
–í–µ—Ç–µ—Ä ${w.windspeed} –∫–∏–ª–æ–º–µ—Ç—Ä–æ–≤ –≤ —á–∞—Å.`;

weather.innerText=
`–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${w.temperature}¬∞C
–í–µ—Ç–µ—Ä: ${w.windspeed} –∫–º/—á`;

speak(text);
}

// ===== –í–†–ê–©–ï–ù–ò–ï =====
function animate(){
requestAnimationFrame(animate);

earth.rotation.y+=0.0015;
clouds.rotation.y+=0.002;
night.rotation.y+=0.0015;

renderer.render(scene,camera);
}
animate();

// ===== RESIZE =====
window.addEventListener("resize",()=>{
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>

</body>
</html>
